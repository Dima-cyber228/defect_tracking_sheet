# Система учёта дефектов на производстве

Это веб-приложение предназначено для учёта, отслеживания и управления дефектами на производстве. Оно позволяет регистрировать дефекты, назначать ответственных и исполнителей, отслеживать статус устранения, прикреплять фотографии и получать уведомления в Telegram.

## Основные функции

*   **Регистрация дефектов:** Добавление новой записи о дефекте с указанием оборудования, описания, участка, уровня опасности и прикреплением фото.
*   **Управление статусом:** Изменение статуса дефекта ("новый", "в работе", "завершён").
*   **Назначение:** Назначение исполнителя и ответственного лица для устранения дефекта.
*   **Фильтрация и просмотр:** Просмотр списка всех дефектов с возможностью фильтрации по участку, статусу, уровню опасности и исполнителю.
*   **Уведомления в Telegram:** Автоматическая отправка уведомлений назначенным исполнителям и ответственным лицам через Telegram-бота.
*   **Администрирование:** Управление справочниками (исполнители, ответственные, участки, оборудование) через отдельную панель.
*   **Подписка на уведомления:** Пользователи могут подписаться на уведомления, связав своё имя в системе с Telegram ID.

## Технологии

*   **Бэкенд:** Python, FastAPI
*   **Фронтенд:** HTML, JavaScript (Fetch API), CSS
*   **База данных:** SQLite
*   **Уведомления:** python-telegram-bot
*   **Зависимости:** см. `requirements.txt`

## Как использовать

1.  **Установка:**
    *   Убедитесь, что на вашем компьютере установлен Python 3.8 или выше и Git.
    *   Клонируйте репозиторий: `git clone <URL_вашего_репозитория>`
    *   Перейдите в папку проекта: `cd defect-tracking-sheet`
    *   (Рекомендуется) Создайте виртуальное окружение: `python -m venv venv`
    *   Активируйте виртуальное окружение:
        *   Windows: `venv\Scripts\activate`
        *   Linux/macOS: `source venv/bin/activate`
    *   Установите зависимости: `pip install -r requirements.txt`

2.  **Конфигурация:**
    *   Переименуйте файл `.env.example` в `.env`.
    *   Откройте файл `.env` и укажите:
        *   `TELEGRAM_BOT_TOKEN`: Токен вашего Telegram-бота (если используете уведомления).
        *   `ADMIN_PASSWORD`: Пароль для доступа к административной панели.
        *   `DATABASE_PATH`: Путь к файлу базы данных SQLite (по умолчанию `defects.db`).

3.  **Запуск:**
    *   Убедитесь, что виртуальное окружение активировано.
    *   Запустите сервер: `uvicorn app.main:app --host 0.0.0.0 --port 8080 --reload`
    *   Откройте браузер и перейдите по адресу `http://localhost:8080`.

4.  **Использование:**
    *   **Главная страница (`/`):** Просмотр списка дефектов, добавление новых, изменение статуса.
    *   **Администрирование (`/admin`):** Вход с паролем из `.env`. Управление списками выбора.
    *   **Подписка (`/subscribe`):** Связывание имени пользователя с Telegram ID для получения уведомлений.

## Настройка под себя

*   **Списки выбора:** Администратор может изменить списки "Исполнители", "Ответственные", "Участки", "Оборудование" через панель администрирования (`/admin`).
*   **Пароль администратора:** Изменяется в файле `.env`.
*   **Токен Telegram-бота:** Изменяется в файле `.env`. После установки токена пользователи могут подписаться на уведомления через страницу `/subscribe`, указав своё имя из системы и Telegram ID.
*   **Внешний вид:** Можно изменить стили CSS, находящиеся внутри HTML-файлов в папке `frontend`.
*   **Логика работы:** Основная логика бэкенда находится в файлах `app/api/`, базы данных в `app/database.py`, уведомлений в `app/telegram_notifier.py`.

## Структура проекта

*   `app/`: Основной код приложения.
    *   `api/`: Эндпоинты FastAPI.
    *   `core/`: Конфигурация и инициализация БД.
    *   `database.py`: Функции работы с SQLite.
    *   `telegram_notifier.py`: Логика отправки уведомлений.
    *   `main.py`: Основной файл приложения FastAPI.
*   `frontend/`: HTML, CSS, JavaScript файлы.
*   `uploads/`: Папка для хранения загруженных фотографий (создаётся автоматически).
*   `.env`: Файл конфигурации.
*   `requirements.txt`: Зависимости проекта.
*   `defects.db`: Файл базы данных SQLite (создаётся автоматически при первом запуске).
